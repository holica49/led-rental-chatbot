# LED 렌탈 MCP 프로젝트 컨텍스트

## 비즈니스 도메인
오리온디스플레이의 LED 렌탈/설치 업무를 자동화하는 카카오톡 챗봇 시스템

## 핵심 기능
1. **설치 서비스**: 상설 LED 설치 상담 및 견적
2. **렌탈 서비스**: 단기 행사용 LED 렌탈 및 견적
3. **멤버쉽 서비스**: 메쎄이상(001) 전용 특별 가격

## 기술 스택 (2025-07-25 기준)
- **Runtime**: Node.js 18+ (ES Modules)
- **Language**: TypeScript 5.7.2
- **Module System**: ES Modules (`"type": "module"`)
- **Framework**: Express 4.21.2
- **Database**: Notion API
- **Deployment**: Railway (자동 배포)
- **Session**: In-memory (Redis 마이그레이션 예정)

## Notion 데이터베이스 스키마
⚠️ **아래 필드명은 절대 변경 불가**

### 기본 정보
- `행사명` (title)
- `고객사` (select)
- `고객명` (rich_text) ← ⚠️ '고객담당자' 아님!
- `고객 연락처` (phone_number)
- `행사장` (rich_text)
- `서비스 유형` (select): 설치, 렌탈, 멤버쉽
- `행사 상태` (status)

### LED 정보 (1-5개소)
- `LED{n} 크기` (rich_text) - 예: "5m x 3m"
- `LED{n} 무대 높이` (number) ← **0mm 허용**
- `LED{n} 오퍼레이터 필요` (checkbox)
- `LED{n} 오퍼레이터 일수` (number)

### 견적 정보
- `총 견적` (number)
- `부가세 포함` (number)
- `견적서` (files) ← 파일 업로드

## 프로세스 플로우

### 🏗️ 설치 서비스
1. 실내/실외 선택
2. 설치 지역 입력
3. 설치 공간 선택
4. 문의 목적 선택
5. 설치 예산 선택
6. 설치 일정 입력
7. 고객사명 입력
8. 담당자 정보 입력
9. Notion 저장 → 영업팀 전달

### 📦 렌탈 서비스
1. 행사명/행사장 입력
2. 실내/실외 선택
3. 지지구조물 선택
4. LED 개수 선택 (1-5)
5. 각 LED별 사양 입력
   - 크기 (가로 x 세로)
   - 무대 높이
   - 오퍼레이터 필요 여부
6. 행사 기간 입력
7. 고객사명 입력
8. 담당자 정보 입력
9. 견적 자동 계산
10. Notion 저장 + 견적서 업로드

### 👥 멤버쉽 서비스
1. 멤버 코드 확인 (001)
2. 행사명/행사장 입력
3. LED 개수 선택
4. 각 LED별 사양 입력
5. 행사 기간 입력
6. 담당자 정보 입력
7. 할인된 견적 자동 계산
8. Notion 저장 + 견적서 업로드

## 가격 정책 (2024년 기준)

### 멤버쉽 (메쎄이상 001)
- LED 모듈: 34,000원/개 (500개 이상)
- 구조물: 
  - 4m 미만: 20,000원/㎡
  - 4m 이상: 25,000원/㎡
- 운반비: 
  - 200개 이하: 20만원
  - 201-400개: 40만원
  - 400개 초과: 70만원

### 일반 렌탈
- LED 모듈: 50,000원/개
- 구조물: 포함
- 운반비:
  - 60개 이하: 30만원
  - 61-100개: 40만원
  - 101개 이상: 50만원
- 기간 할증:
  - 5일 이하: 0%
  - 5-15일: 20%
  - 15-30일: 30%

## 현재 상태 및 이슈

### ✅ 완료
- ES Module 전환
- Railway 배포
- 기본 기능 정상 작동

### ⚠️ 개선 필요
1. **코드 구조**: kakao-chatbot.ts 2000줄+ → 추가 분리 필요
2. **타입 안정성**: TypeScript strict mode 비활성화 (47개 오류)
3. **테스트**: 테스트 코드 없음
4. **세션**: 메모리 기반 → Redis 필요
5. **로깅**: 체계적인 로깅 시스템 부재

### 📁 주요 파일 위치
```
src/
├── server.ts              # Express 서버 (Railway)
├── index.ts               # MCP 서버 (Claude)
├── tools/
│   ├── kakao-chatbot.ts   # 메인 챗봇 로직
│   ├── notion-mcp.ts      # Notion 연동
│   ├── calculate-quote.ts # 견적 계산
│   └── handlers/          # 서비스별 핸들러
│       ├── rental.ts
│       ├── install.ts
│       └── membership.ts
```

## 중요 주의사항

1. **Notion 필드명 절대 변경 금지**
2. **무대 높이 0mm 허용 필수**
3. **설치 서비스는 담당자 언급 안함**
4. **모든 import에 .js 확장자 필수**
5. **Kakao 응답은 5초 이내**